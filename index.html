<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" />
    <title>App Santiago</title>
  </head>
  <body>
    <section class="form-register">
      <h4>¿Que turno me toca?</h4>
      <label for="turno">Selecciona el turno que tienes hoy</label>
      <select class="controls" name="turno" id="turno" onchange="turno()">
        <option value="1">Todo el día</option>
        <option value="2">Entro a velada</option>
        <option value="3">Salgo de velada</option>
      </select>
      <br />
      <label for="fecha">Selecciona la fecha que quieres saber</label>
      <input
        class="controls"
        type="date"
        name="fecha"
        id="fecha"
        onclick="this.showPicker()"
        onchange="turno()"
      />
      <br />
      <p id="resultado"></p>
    </section>
    <script>
      const turnos = [
        '',
        'Todo el día',
        'Entrar a velada',
        'Salir de velada',
        'todo el día',
        'Entrar a velada',
      ];
      const hoy = new Date();
      document.getElementById('fecha').value =
        hoy.getFullYear() + '-' + (hoy.getMonth() + 1) + '-' + hoy.getDate();
      document.getElementById('fecha').min =
        hoy.getFullYear() + '-' + (hoy.getMonth() + 1) + '-' + hoy.getDate();
      const restultado = document.getElementById('resultado');

      asignarTurno = (turno) =>
        (restultado.innerText = 'Turno: ' + turnos[turno]);

      asignarTurno(1);

      function turno() {
        const turno = document.getElementById('turno').value;
        const fecha = document.getElementById('fecha').value;
        const fechaSplit = fecha.split('-');
        const hoySinHoras = new Date(
          hoy.getFullYear() +
            '-' +
            (hoy.getMonth() + 1) +
            (hoy.getDate() >= 10 ? '-' : '-0') +
            hoy.getDate() +
            'T00:00:00'
        );
        const fechaTurno = new Date(
          fecha
            ? fechaSplit[0] +
              '-' +
              fechaSplit[1] +
              '-' +
              fechaSplit[2] +
              'T00:00:00'
            : hoySinHoras
        );
        const diff = fechaTurno - hoySinHoras;
        const diffDys = diff / (1000 * 60 * 60 * 24);
        const siguieteTurno = (diffDys % 3) + +turno;
        asignarTurno(siguieteTurno);
      }
    </script>
  </body>
</html>
